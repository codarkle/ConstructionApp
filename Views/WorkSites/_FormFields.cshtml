@model ConstructionApp.ViewModels.WorkSiteViewModel

<div asp-validation-summary="ModelOnly" class="text-danger"></div>
<div class="row">
    <div class="col-md-6 mb-3">
        <div class="d-flex align-items-center justify-content-center flex-column h-100 border border-primary rounded">
            <div id="dropZone" class="text-center p-2" style="cursor: pointer;">
                <input type="file" asp-for="Picture" id="pictureInput" accept="image/*" style="display:none;" />
                <div id="previewContainer">
                    <img id="picturePreview" src="@(!string.IsNullOrEmpty(Model.PicturePath) ? Url.Content(Model.PicturePath) : "/images/worksite.svg")"
                    alt="Picture Preview" style="max-width: 200px;" />
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="row mb-3 align-items-center">
            <label asp-for="Address" class="col-sm-4 col-form-label ">Address</label>
            <div class="col-sm-8">
                <input asp-for="Address" class="form-control" />
                <span asp-validation-for="Address" class="text-danger"></span>
            </div>
        </div>
        <div class="row mb-3 align-items-center">
            <label asp-for="Amount" class="col-sm-4 col-form-label ">Amount</label>
            <div class="col-sm-8">
                <input asp-for="Amount" class="form-control" type="number"/>
                <span asp-validation-for="Amount" class="text-danger"></span>
            </div> 
        </div>
        <div class="row mb-3 align-items-center">
            <label asp-for="Safety" class="col-sm-4 col-form-label ">Security</label>
            <div class="col-sm-8">
                <input asp-for="Safety" class="form-control" type="number" />
                <span asp-validation-for="Safety" class="text-danger"></span>
            </div> 
        </div> 
        <div class="row mb-3 align-items-center">
            <label asp-for="CAP" class="col-sm-4 col-form-label "></label>
            <div class="col-sm-8">
                <input asp-for="CAP" class="form-control" />
                <span asp-validation-for="CAP" class="text-danger"></span>
            </div> 
        </div>
    </div>
</div>
<div class="row mb-3">
    <div class="col-md-6">
        <div class="row mb-3 align-items-center">
            <label asp-for="Name" class="col-sm-5 col-form-label ">Name</label>
            <div class="col-sm-7">
                <input asp-for="Name" class="form-control" />
                <span asp-validation-for="Name" class="text-danger"></span>
            </div>
        </div>
        <div class="row mb-3 align-items-center">
            <label asp-for="ManagerId" class="col-sm-5 col-form-label ">Manager</label>
            <div class="col-sm-7">
                <select asp-for="ManagerId" asp-items="Model.ManagerList" class="form-control">
                    <option value="">-- Select --</option>
                </select>
                <span asp-validation-for="ManagerId" class="text-danger"></span>
            </div>
        </div>
    </div> 
    <div class="col-md-6">
        <div class="row mb-3 align-items-center">
            <label asp-for="DateStart" class="col-sm-4 col-form-label ">DateStart</label>
            <div class="col-sm-8">
                <input asp-for="DateStart" class="form-control" type="date" id="DateStart" />
                <span asp-validation-for="DateStart" class="text-danger"></span>
            </div> 
        </div> 
        <div class="row mb-3 align-items-center">
            <label asp-for="DateEnd" class="col-sm-4 col-form-label ">DateEnd</label>
            <div class="col-sm-8">
                <input asp-for="DateEnd" class="form-control" type="date" id="DateEnd" />
                <span asp-validation-for="DateEnd" class="text-danger"></span>
            </div> 
        </div> 
    </div>
</div>

<hr />

<div class="row">
    <h5>+Add Worker</h5>
    <div class="col-md-6">
        <input type="text" id="workerSearch" class="form-control" placeholder="No exist workers..." />
    </div>
    <div class="col-md-6">
        <button type="button" id="addWorkerBtn" class="btn btn-primary" disabled>Confirm</button>
    </div>
</<div>
    <ul id="workerList" class="list-group m-3">   
        @if (Model.AssignedWorkers != null)
        {
            for (int i = 0; i < Model.AssignedWorkers.Count(); i++)
            {
                <li class="list-group-item d-flex justify-content-between align-items-center" id="worker-@Model.AssignedWorkers[i].Id">
                    @Model.AssignedWorkers[i].UserName
                    <button type="button" class="btn btn-sm btn-danger remove-worker" data-id="@Model.AssignedWorkers[i].Id"><i class="bi bi-trash"></i></button>
                </li>
            }
        }    
    </ul>
    <div id="selectedWorkerInputs"> 
        @if (Model.SelectedWorkerIds != null)
        {
            for (int i = 0; i < Model.SelectedWorkerIds.Count(); i++)
            {
                <input type="hidden" name="SelectedWorkerIds" value="@Model.SelectedWorkerIds[i]" id="hidden-worker-@Model.SelectedWorkerIds[i]" />
            }
        }
</div>
 
<div class="mb-3 d-flex align-items-center">
    <label class="form-label me-3">Attach</label>
    <button type="button" id="btnAddFile" class="btn btn-outline-primary btn-sm">+ Add File</button>
    <div id="dynamicFileInputs"></div>
</div>

<div class="table-responsive">
    <table class="table table-bordered" id="filesTable">
        <thead class="table-light">
            <tr>
                <th>FileName</th>
                <th>Description</th>
                <th>Autore</th>
                <th>Data</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
        @for (int i = 0; i < Model.AttachFiles.Count; i++)
        {
            var displayStyle = Model.AttachFiles[i].Dumped ? "display:none;" : "";
            <tr data-index="@i" style="@displayStyle">
                <td>
                    <input asp-for="@Model.AttachFiles[i].FileName" type="text" class="form-control" style="width:100px" />
                    <span asp-validation-for="@Model.AttachFiles[i].FileName" class="text-danger"></span>
                </td>
                <td>
                    <input asp-for="@Model.AttachFiles[i].Description" type="text" class="form-control" />
                    <span asp-validation-for="@Model.AttachFiles[i].Description" class="text-danger"></span>
                </td>
                <td>
                    <input asp-for="@Model.AttachFiles[i].Author" type="text" class="form-control" />
                    <span asp-validation-for="@Model.AttachFiles[i].Author" class="text-danger"></span>
                </td>
                <td>
                    <input asp-for="@Model.AttachFiles[i].Deadline" type="date" class="form-control" />
                    <span asp-validation-for="@Model.AttachFiles[i].Deadline" class="text-danger"></span>
                </td>
                <td>
                    <input asp-for="@Model.AttachFiles[i].Dumped" type="hidden"/>
                    <input asp-for="@Model.AttachFiles[i].TempId" type="hidden"/>
                    <input asp-for="@Model.AttachFiles[i].StoredFilePath" type="hidden"/>
                    <button type="button" class="btn btn-info btn-sm view-file">
                        <i class="bi bi-eye"></i>
                    </button>
                    <button type="button" class="btn btn-danger btn-sm remove-row">
                        <i class="bi bi-trash"></i> 
                    </button>
                </td>
            </tr>
        } 
        </tbody>
    </table>
</div>